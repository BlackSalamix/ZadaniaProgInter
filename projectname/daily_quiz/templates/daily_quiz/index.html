<!DOCTYPE html>
<html lang="pl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Codzienny Abstrakt</title>
		<style>
			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background-color: #f0f2f5;
				color: #333;
				margin: 0;
				padding: 20px;
			}
			.container {
				width: 100%;
				max-width: 600px;
				margin: 40px auto;
				padding: 0 15px;
				box-sizing: border-box;
			}

			.hero-section {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 40px;
				border-radius: 15px;
				text-align: center;
				box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
				margin-bottom: 30px;
			}
			.date-badge {
				background: rgba(255, 255, 255, 0.2);
				padding: 5px 15px;
				border-radius: 20px;
				font-size: 0.9em;
				text-transform: uppercase;
				letter-spacing: 1px;
			}
			h1 {
				font-size: 2.5em;
				margin: 20px 0;
			}

			.answer-form {
				background: white;
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
				margin-bottom: 30px;
			}
			.form-control {
				width: 100%;
				padding: 10px;
				margin-bottom: 10px;
				border: 1px solid #ddd;
				border-radius: 5px;
				box-sizing: border-box;
			}
			button.btn-primary {
				background-color: #764ba2;
				color: white;
				border: none;
				padding: 10px 20px;
				border-radius: 5px;
				cursor: pointer;
				font-size: 1em;
				transition: background 0.3s;
			}
			button.btn-primary:hover {
				background-color: #5a3780;
			}

			.filters {
				margin-bottom: 15px;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			.filters a {
				text-decoration: none;
				color: #666;
				margin-right: 15px;
				font-weight: bold;
			}
			.filters a.active {
				color: #764ba2;
				border-bottom: 2px solid #764ba2;
			}

			.answer-card {
				background: white;
				padding: 20px;
				border-radius: 10px;
				margin-bottom: 15px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);

				transition: all 0.5s ease;
				border: 2px solid transparent;
			}

			.answer-content {
				flex-grow: 1;
				padding-right: 20px;
			}

			.answer-card.best-answer {
				border-color: #f1c40f;
				background-color: #fffcf0;
				position: relative;
				overflow: hidden;
				animation: goldPulse 1s ease-out;
			}

			.answer-card.best-answer::before {
				content: "üèÜ";
				position: absolute;
				top: 10px;
				right: 50px;
				font-size: 1.8em;

				animation: trophyPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
			}
			.author {
				font-weight: bold;
				color: #555;
				font-size: 0.9em;
				margin-bottom: 5px;
				display: block;
			}
			.text {
				font-size: 1.1em;
				line-height: 1.5;
			}

			.like-box {
				text-align: center;
				min-width: 60px;
			}
			.like-btn {
				background: none;
				border: 2px solid #ddd;
				border-radius: 50%;
				width: 40px;
				height: 40px;
				cursor: pointer;
				color: #ff4757;
				font-size: 1.2em;
				transition: all 0.2s;
			}
			.like-btn.liked {
				background-color: #ff4757;
				color: white;
				border-color: #ff4757;
			}
			.like-btn:hover {
				background-color: #ff4757;
				color: white;
				border-color: #ff4757;
			}
			.like-count {
				display: block;
				margin-top: 5px;
				font-weight: bold;
				color: #777;
			}

			.footer-link {
				display: block;
				text-align: center;
				margin-top: 40px;
				color: #666;
			}
			@media (max-width: 640px) {
				body {
					padding: 0;
				}
				.container {
					margin-top: 10px;
					border-radius: 0;
				}

				h1 {
					font-size: 1.8em;
				}
			}

			.date-info {
				font-size: 0.8em;
				color: #999;
				font-weight: normal;
				margin-left: 10px;
			}
			@keyframes trophyPop {
				0% {
					transform: scale(0) rotate(-45deg);
					opacity: 0;
				}
				50% {
					transform: scale(1.5) rotate(10deg);
				}
				100% {
					transform: scale(1) rotate(0deg);
					opacity: 1;
				}
			}

			@keyframes goldPulse {
				0% {
					box-shadow: 0 0 0 0 rgba(241, 196, 15, 0.4);
				}
				70% {
					box-shadow: 0 0 0 10px rgba(241, 196, 15, 0);
				}
				100% {
					box-shadow: 0 0 0 0 rgba(241, 196, 15, 0);
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="hero-section">
				<span class="date-badge">Pytanie na dzi≈õ: {{ today_date }}</span>
				<h1>{{ question.text }}</h1>
			</div>

			<div class="answer-form">
				<h3>Twoja odpowied≈∫:</h3>
				<form method="POST">
					{% csrf_token %} {{ form.nick }} {{ form.content }}
					<button type="submit" class="btn-primary">Wy≈õlij odpowied≈∫</button>
				</form>
			</div>

			<div class="filters">
				<div>
					Sortuj:
					<a
						href="?sort=best"
						class="{% if request.GET.sort != 'new' %}active{% endif %}"
						>Najlepsze</a
					>
					<a
						href="?sort=new"
						class="{% if request.GET.sort == 'new' %}active{% endif %}"
						>Najnowsze</a
					>
				</div>
				<span>Odpowiedzi: {{ answers.count }}</span>
			</div>

			{% for answer in answers %}
			<div
				class="answer-card {% if current_sort != 'new' and answer.likes_count == max_likes and max_likes > 0 %} best-answer {% endif %}"
			>
				<div class="answer-content">
					<span class="author">
						{{ answer.nick }}
						<span class="date-info">{{ answer.created_at|date:"H:i" }}</span>
					</span>
					<div class="text">{{ answer.content }}</div>
				</div>
				<div class="like-box">
					<button
						class="like-btn {% if answer.id in liked_answers_ids %}liked{% endif %}"
						onclick="likeAnswer({{ answer.id }}, this)"
					>
						‚ô•
					</button>
					<span class="like-count" id="count-{{ answer.id }}"
						>{{ answer.likes_count }}</span
					>
				</div>
			</div>
			{% empty %}
			<p style="text-align: center; color: #888">
				Nikt jeszcze nie odpowiedzia≈Ç. BƒÖd≈∫ pierwszy!
			</p>
			{% endfor %}

			<a href="{% url 'add_question' %}" class="footer-link"
				>Masz pomys≈Ç na w≈Çasne pytanie? Dodaj je tutaj!</a
			>
		</div>

		<script>
			async function likeAnswer(id, btnElement) {
				try {
					const csrftoken = document.querySelector(
						"[name=csrfmiddlewaretoken]"
					).value;

					const response = await fetch(`/quiz/like/${id}/`, {
						method: "POST",
						headers: {
							"X-CSRFToken": csrftoken,
							"Content-Type": "application/json",
						},
					});

					if (response.ok) {
						const data = await response.json();

						const countSpan = document.getElementById(`count-${id}`);
						countSpan.textContent = data.likes;

						if (data.action === "liked") {
							btnElement.classList.add("liked");
						} else {
							btnElement.classList.remove("liked");
						}

						updateBestBadges();
					}
				} catch (error) {
					console.error("B≈ÇƒÖd:", error);
				}
			}

			function updateBestBadges() {
				const urlParams = new URLSearchParams(window.location.search);
				if (urlParams.get("sort") === "new") return;

				const allCounts = document.querySelectorAll(".like-count");
				let currentMax = 0;

				allCounts.forEach((span) => {
					const val = parseInt(span.textContent);
					if (val > currentMax) currentMax = val;
				});

				allCounts.forEach((span) => {
					const card = span.closest(".answer-card");
					const val = parseInt(span.textContent);

					if (currentMax > 0 && val === currentMax) {
						card.classList.add("best-answer");
					} else {
						card.classList.remove("best-answer");
					}
				});
			}
		</script>
	</body>
</html>
